## secret mount

refer

- https://kubernetes.io/docs/concepts/configuration/secret/

1. Use secret like a file in a pad

    ```
    apiVersion: v1
    kind: Pod
    metadata:
      name: mypod
    spec:
      containers:
      - name: mypod
        image: redis
        volumeMounts:
        - name: foo
          mountPath: "/etc/foo"
          readOnly: true
      volumes:
      - name: foo
        secret:
          secretName: mysecret
          optional: false 
    ```

2. create pods
    ```
    kubectl apply -f ./pods.yml
    ```


3. Secret key for a particular pat
      ```
      apiVersion: v1
      kind: Pod
      metadata:
        name: mypod
      spec:
        containers:
        - name: mypod
          image: redis
          volumeMounts:
          - name: foo
            mountPath: "/etc/foo"
            readOnly: true
        volumes:
        - name: foo
          secret:
            secretName: mysecret
            items:
            - key: username
              path: my-group/my-username
      ```
- The username key in mysecret is available in the /etc/foo/my-group/my-username path instead of the /etc/foo/username path in the container.
- The password key of the secret object is not projected.


## Fire Permission
refer

- https://kubernetes.io/docs/concepts/configuration/secret/
1. Secret File Permission
      ```
      apiVersion: v1
      kind: Pod
      metadata:
        name: mypod
      spec:
        containers:
        - name: mypod
          image: redis
          volumeMounts:
          - name: foo
            mountPath: "/etc/foo"
        volumes:
        - name: foo
          secret:
            secretName: mysecret
            defaultMode: 0400
      ```

  - The secret is mounted on /etc/foo, and the permission of all files generated by the secret volume mount is 0400.

## Secret Uncorrectable
refer

- https://kubernetes.io/docs/concepts/configuration/secret/

1. You can create an unmodifiable secret by setting the immutable field to true.
    ~~~
    apiVersion: v1
    kind: Secret
    metadata:
      ...
    data:
      ...
    immutable: true
    ~~~
2. Configuration Example
      ```
      apiVersion: v1
      kind: Pod
      metadata:
        name: mypod
      immutable: true
      spec:
        containers:
        - name: mypod
          image: redis
          volumeMounts:
          - name: foo
            mountPath: "/etc/foo"
        volumes:
        - name: foo
          secret:
            secretName: mysecret
            defaultMode: 0400
      ```
