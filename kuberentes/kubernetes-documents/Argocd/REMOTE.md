## argocd install

refer
- https://archive.eksworkshop.com/intermediate/290_argocd/install/

1. Install Argo CD
    ```sh
    kubectl create namespace argocd
    kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/v2.4.7/manifests/install.yaml
    ```

2. Install Argo CD CLI
    ```sh
    sudo curl --silent --location -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/v2.4.7/argocd-linux-amd64
    sudo chmod +x /usr/local/bin/argocd
    ```

## Expose
1. Expose argocd-server

    default argocd-server is not publicaly exposed. 

    ```sh
    kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'
    ```

## Login
1. First, save ARGOCD_SERVER as a variable.
    ```sh
    export ARGOCD_SERVER=`kubectl get svc argocd-server -n argocd -o json | jq --raw-output '.status.loadBalancer.ingress[0].hostname'`
    ```
2. The initial password is autogenerated with the pod name of the ArgoCD API server
    ```sh
    export ARGO_PWD=`kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d`
    ```

3. Use automatically generated password
    ```
    argocd login $ARGOCD_SERVER --username admin --password $ARGO_PWD --insecure
    ```

## access
1. Copy the generated load balancer address
    ```txt
    example) aed4b9dce58984544b6e12d60b483fc1-1434689176.ap-northeast-2.elb.amazonaws.com
    ```

2. Type the echo $ARGO_PWD command to copy it.

3. Proceed with the login.
    ```
    username: admin
    password: <Copied $ARGO_PWD> value
    ```